<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Limpieza - Piso 1 DEBUG</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header .subtitle { font-size: 1.3em; opacity: 0.9; font-weight: 300; }
        .debug { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; margin: 20px; border-radius: 10px; font-family: monospace; font-size: 0.9em; max-height: 300px; overflow-y: auto; }
        .debug h3 { margin-bottom: 10px; color: #856404; }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 30px; background: #f7fafc; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        .stat-card .number { font-size: 3em; font-weight: bold; color: #667eea; margin: 10px 0; }
        .stat-card .label { font-size: 1.1em; color: #718096; text-transform: uppercase; }
        .records-container { padding: 30px; }
        .loading { text-align: center; padding: 60px; font-size: 1.5em; color: #718096; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöΩ Control de Limpieza - DEBUG</h1>
            <div class="subtitle">Piso 1</div>
        </div>
        
        <div class="debug" id="debug">
            <h3>üìä Informaci√≥n de Debug:</h3>
            <div id="debugInfo">Cargando...</div>
        </div>
        
        <div class="stats-container">
            <div class="stat-card"><div class="number" id="totalRegistros">0</div><div class="label">Registros</div></div>
            <div class="stat-card"><div class="number" id="registrosHoy">0</div><div class="label">Hoy</div></div>
            <div class="stat-card"><div class="number" id="promedioTiempo">0</div><div class="label">Promedio (min)</div></div>
        </div>
        
        <div class="records-container">
            <div id="registros"><div class="loading">‚è≥ Cargando datos...</div></div>
        </div>
    </div>
    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQmUpcN4q6d7okxjnMlUuqmzh6rVRJ-rt9Eq7IW-HnK20Vqp2JZ6MKd3_tTaPFPLQ27XgoiZGu4w-HS/pub?gid=1532232990&single=true&output=csv';
        
        async function cargarDatos() {
            let debugHTML = '';
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                
                debugHTML += `<strong>‚úÖ CSV descargado:</strong> ${csvText.length} caracteres<br><br>`;
                debugHTML += `<strong>Primeras 200 caracteres del CSV:</strong><br>${csvText.substring(0, 200)}<br><br>`;
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        const allData = results.data;
                        
                        debugHTML += `<strong>Total de filas parseadas:</strong> ${allData.length}<br><br>`;
                        
                        if (allData.length > 0) {
                            debugHTML += `<strong>Columnas encontradas:</strong><br>`;
                            Object.keys(allData[0]).forEach(key => {
                                debugHTML += `- "${key}"<br>`;
                            });
                            
                            debugHTML += `<br><strong>Primera fila de ejemplo:</strong><br>`;
                            const firstRow = allData[0];
                            Object.keys(firstRow).forEach(key => {
                                debugHTML += `<strong>${key}:</strong> "${firstRow[key]}"<br>`;
                            });
                            
                            debugHTML += `<br><strong>Valores en columna de piso (primeras 5 filas):</strong><br>`;
                            allData.slice(0, 5).forEach((row, idx) => {
                                const pisoCol = Object.keys(row).find(k => k.includes('piso') || k.includes('Piso'));
                                debugHTML += `Fila ${idx + 1}: "${row[pisoCol]}"<br>`;
                            });
                        }
                        
                        document.getElementById('debugInfo').innerHTML = debugHTML;
                    },
                    error: function(error) {
                        debugHTML += `<strong>‚ùå Error al parsear CSV:</strong> ${error}<br>`;
                        document.getElementById('debugInfo').innerHTML = debugHTML;
                    }
                });
                
            } catch (error) {
                debugHTML += `<strong>‚ùå Error al cargar:</strong> ${error}<br>`;
                document.getElementById('debugInfo').innerHTML = debugHTML;
            }
        }
        
        cargarDatos();
    </script>
</body>
</html>